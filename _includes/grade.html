{%- comment -%}
Formats the base/pergrade of a grade stat entry. Intended to be captured into a variable.

Args:
    grade_stats: The grade stat entry to process.
{%- endcomment -%}

{%- if include.grade_stats -%}
    {%- if include.grade_stats.base > 0 -%}
        {%- assign base = "+" | append: include.grade_stats.base -%}
    {%- else -%}
        {%- assign base = include.grade_stats.base | replace: "-", "&minus;" -%}
    {%- endif -%}

    {%- if include.grade_stats.scale -%}
        {%- if base == "+1" -%}
            {%- assign base = "+" | append: include.grade_stats.scale -%}
        {%- elsif base == "&minus;1" -%}
            {%- assign base = "&minus;" | append: include.grade_stats.scale -%}
        {%- else -%}
            {%- assign base = base | append: "&times;" | append: include.grade_stats.scale -%}
        {%- endif -%}
    {%- endif -%}

    {%- if include.grade_stats.offset -%}
        {%- assign base = "(" | append: base | append: " " -%}
        {%- if include.grade_stats.offset > 0 -%}
            {%- assign base = base | append: "+" | append: include.grade_stats.offset -%}
        {%- else -%}
            {%- assign minus_replacement = include.grade_stats.offset | replace: "-", "&minus;" -%}
            {%- assign base = base | append: minus_replacement -%}
        {%- endif -%}
        {%- assign base = base | append: ")" -%}
    {%- endif -%}

    {%- if include.grade_stats.per_grade > 0 -%}
        {%- assign per_grade = "+" | append: include.grade_stats.per_grade -%}
    {%- else -%}
        {%- assign per_grade = include.grade_stats.per_grade | replace: "-", "&minus;" -%}
    {%- endif -%}

    {%- if include.grade_stats.per_grade_scale -%}
        {%- if per_grade == "+1" -%}
            {%- assign per_grade = "+" | append: include.grade_stats.per_grade_scale -%}
        {%- elsif per_grade == "&minus;1" -%}
            {%- assign per_grade = "&minus;" | append: include.grade_stats.per_grade_scale -%}
        {%- else -%}
            {%- assign per_grade = per_grade
                            | append: "&times;"
                            | append: include.grade_stats.per_grade_scale -%}
        {%- endif -%}
    {%- endif -%}

    {%- if include.grade_stats.per_grade_offset -%}
        {%- assign per_grade = "(" | append: per_grade | append: " " -%}
        {%- if include.grade_stats.per_grade_offset > 0 -%}
            {%- assign per_grade = per_grade
                                   | append: "+"
                                   | append: include.grade_stats.per_grade_offset -%}
        {%- else -%}
            {%- assign minus_replacement = include.grade_stats.per_grade_offset
                                           | replace: "-", "&minus;" -%}
            {%- assign per_grade = per_grade | append: minus_replacement -%}
        {%- endif -%}
        {%- assign per_grade = per_grade | append: ")" -%}
    {%- endif -%}

    {{base}} {{per_grade}}
{%- else -%}
    -
{%- endif -%}
