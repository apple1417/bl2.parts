<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Calculation Order</title>
    <link rel="stylesheet" type="text/css" href="/bl2/style.css">
    <link rel="stylesheet" type="text/css" href="/bl2/colours.css">
</head>
<body>
    <h1>A Note on Calculation Order</h1>
    <div class="text">
        If you've read through any of the detailed guides, you'll know there are two standard formulas used for all bonuses:
        <br>
        <code>
            FINAL = (BASE + <span class="preAdd">PreAdd</span>) &times;
            (1 + <span class="scale">Positive Scale</span>)&divide;(1 - <span class="scale">Negative Scale</span>)
            + <span class="postAdd">PostAdd</span>
            <br>
            BONUS = BASE + PERGRADE&times;<span class="grade">Grades</span>
        </code>
        <br>
        These forumlas work fine when just calculating using item/weapon parts, but if you try to add other bonuses into the mix, such as those from skills, you might start having issues.
        This is because the game actually changes the base value of the calculation inbetween applying the bonuses.
        <br>
        At the start of item/weapon initalization, each attribute will have a certain base value, which you'll find listed in all the part guides.
        The game applies all bonuses from the parts, to find the value that displays on the item card.
        It then sets the base value to this calculated value, and removes all the part bonuses so they don't apply twice.
        Any bonus applied after item initalization will work off of this new base value instead.
        <br>
        Note that this does not affect all attributes, testing shows that it's only those stored on the weapon/item.
        Unfortuantly the functions controlling this do not decompile, so this can't be 100% confirmed.
        <br>
        <h3>Example</h3>
        The Fibber is a great example of how this works.
        The barrel gives many large bonuses, which are incorporated into the new base value that is shown on the card.
        A BPD then enables extra bonuses after item initalization to give it it's actual stats.
        <br>
        To make things easy in this example, we'll look at the mag size on a Maliwan grip Crit Fibber, with no accessory.
        In game this gives 1970 mag size on the card, but 15 in reality.
        <br>
        <br>
        The relevant numbers here are:
        <div class="smallText">
            15 Base Mag Size on Hyperion Pistols
            <br>Mag Size Grades on Hyperion Pistols are <span class="scale">scales</span> with 0 base and +0.07 per-grade.
            <br>Blue Hyperion Body gives <span class="grade">+5</span>.
            <br>The Crit Fibber's Barrel gives <span class="scale">+130</span>.
            <br>The Crit Fibber's BPD gives <span class="scale">-128</span>, which is applied after initalization.
        </div>
        <br>
        Using these numbers we can calculate both values we observed earlier as follows:
        <br>
        <code>
            FINAL = (15 + [0]) &times; (1 + [130 + (0 + 0.07 &times; 5)]) &divide; (1 - [0]) + [0]
            <br>
            NEWBASE = FINAL = 1970.25 = 1970
            <br>
            FINAL = (1970 + [0]) &times; (1 + [0]) &divide; (1 - [-128]) + [0]
            <br>
            FINAL = 15.271... = 15
        </code>
    </div>
</body>
</html>
